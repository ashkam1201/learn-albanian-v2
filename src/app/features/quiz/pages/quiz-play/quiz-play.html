<div class="quiz-play">
  <app-progress-header
    *ngIf="!finished()"
    [currentIndex]="currentIndexDisplay()"
    [total]="quizEngine.totalQuestions()"
    [score]="quizEngine.score()"
  />

  <ng-container *ngIf="!finished() && quizEngine.currentQuestion() as question; else finishedState">
    <app-quiz-card align="center" class="play-card">
      <app-question-prompt
        [promptText]="question.prompt"
        [toLang]="question.toLang"
        [fromLang]="question.fromLang"
      />

      <div class="input-row">
        <app-answer-input
          [disabled]="quizEngine.status() !== 'idle'"
          (submitted)="handleSubmit($event)"
        >
          <ng-container *ngIf="quizSettings.showHints()">
            <app-hint-button
              [disabled]="quizEngine.status() !== 'idle'"
              [hintsLeft]="quizEngine.hintsLeft()"
              (requestHint)="handleRequestHint()"
            />
          </ng-container>
        </app-answer-input>
      </div>

      <app-hint-panel
        *ngIf="quizSettings.showHints()"
        [visible]="!!quizEngine.currentHint()"
        [hintText]="quizEngine.currentHint() || ''"
      />

      <app-feedback-banner
        [status]="quizEngine.status()"
        [correctAnswer]="question.answer"
        [yourAnswer]="quizEngine.lastAnswer() ?? ''"
      />

      <app-next-button
        *ngIf="quizEngine.status() !== 'idle'"
        [isLast]="quizEngine.isLastQuestion()"
        (next)="handleNext()"
      />
    </app-quiz-card>
  </ng-container>

  <ng-template #finishedState>
    <app-quiz-card align="center" class="finished-card">
      <h2>Finished!</h2>
      <p>You scored {{ quizEngine.score() }} / {{ quizEngine.totalQuestions() }}.</p>
      <button mat-raised-button color="primary" (click)="restart()">Play again</button>
    </app-quiz-card>
  </ng-template>
</div>
